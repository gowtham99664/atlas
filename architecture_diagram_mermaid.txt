graph TB
    %% IoT Smart Home Dashboard - System Architecture
    %% Copy this entire content and paste into Draw.io Mermaid import

    %% Define Styles
    classDef presentation fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1976D2
    classDef service fill:#E8F5E8,stroke:#388E3C,stroke-width:2px,color:#388E3C
    classDef model fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#F57C00
    classDef data fill:#F5F5F5,stroke:#616161,stroke-width:2px,color:#616161
    classDef external fill:#FFEBEE,stroke:#D32F2F,stroke-width:2px,color:#D32F2F
    classDef core fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:white

    %% Presentation Layer
    subgraph PL["🖥️ PRESENTATION LAYER"]
        CLI[SmartHomeDashboard.java<br/>📋 18 Menu Options<br/>🔍 Input Validation<br/>🧭 Navigation System]
        SCAN[Scanner Input/Output<br/>⌨️ User Input<br/>📺 Display Output<br/>✅ Validation]
        NAV[Menu Navigation<br/>🔄 Flow Control<br/>📍 State Management<br/>🏠 Return to Menu]
    end

    %% Service Layer
    subgraph SL["⚙️ SERVICE LAYER"]
        %% Core Hub
        SHS[SmartHomeService<br/>🎛️ Central Orchestrator<br/>🔐 Session Management<br/>📊 Business Logic Hub<br/>🛡️ Security Enforcement]

        %% User Management
        CS[CustomerService<br/>👤 User Authentication<br/>🔐 BCrypt Password Hashing<br/>📝 Registration & Profile<br/>🔄 Password Reset]

        %% Device Management
        GS[GadgetService<br/>🏠 Device Operations<br/>⚡ Real-time Control<br/>📊 Status Monitoring<br/>🔧 CRUD Operations]

        %% Energy & Analytics
        EMS[EnergyManagementService<br/>⚡ Consumption Tracking<br/>💰 Cost Analysis<br/>📈 Usage Reports<br/>🎯 Efficiency Tips]

        %% Automation Services
        TS[TimerService<br/>⏰ Scheduling System<br/>🔄 Auto Execution<br/>⚙️ Cron-like Jobs<br/>💾 Persistence]

        SS[SmartScenesService<br/>🎬 8 Pre-configured Scenes<br/>✨ Custom Scenes<br/>🎭 Multi-device Control<br/>⚡ One-click Execution]

        %% Integration Services
        WS[WeatherService<br/>🌤️ Weather Data Fetching<br/>🤖 Smart Recommendations<br/>📋 Automation Rules<br/>🔮 5-Day Forecasting]

        CES[CalendarEventService<br/>📅 Event Management<br/>🤖 Context-aware Automation<br/>🔄 Integration Hub<br/>⚡ Trigger System]

        DHS[DeviceHealthService<br/>💊 Health Monitoring<br/>🔧 Maintenance Alerts<br/>📊 Performance Analytics<br/>📈 System Optimization]

        %% Utility Services
        SM[SessionManager<br/>🔐 Authentication State<br/>👤 User Context<br/>🛡️ Security Tokens<br/>⏱️ Timeout Management]
    end

    %% Model Layer
    subgraph ML["📋 MODEL LAYER"]
        CUST[Customer Entity<br/>👤 User Profile Data<br/>🔐 Encrypted Credentials<br/>👥 Group Relationships<br/>📊 Usage Statistics]

        GAD[Gadget Entity<br/>🏠 Device Information<br/>⚡ Power & Status Data<br/>⏱️ Usage Tracking<br/>💰 Energy Consumption]

        DP[DevicePermission Entity<br/>🔐 Access Control<br/>👥 User-Device Mapping<br/>🎭 Role Management<br/>📅 Grant Tracking]

        DER[DeletedDeviceEnergyRecord<br/>📊 Historical Energy Data<br/>💰 Billing Preservation<br/>🗂️ Archive Management<br/>📈 Cost Analysis]
    end

    %% Data Layer
    subgraph DL["💾 DATA LAYER"]
        DDB[DynamoDB Local<br/>🏠 Local NoSQL Database<br/>⚡ High Performance<br/>🔐 ACID Transactions<br/>📦 JSON Document Store]

        CT[Customer Table<br/>🔑 PK: email<br/>🆔 SK: customerId<br/>📊 GSI: groupId-index]

        GT[Gadget Table<br/>🔑 PK: customerId<br/>🆔 SK: deviceType+roomName<br/>📊 GSI: status-index]

        PT[DevicePermission Table<br/>🔑 PK: permissionId<br/>📊 GSI: ownerEmail-index<br/>📊 GSI: memberEmail-index]

        ET[DeletedEnergyRecord Table<br/>🔑 PK: originalOwner<br/>🆔 SK: deletionDate+recordId<br/>📊 GSI: monthly-billing-index]
    end

    %% External Systems
    subgraph EXT["🌐 EXTERNAL INTEGRATIONS"]
        WA[Weather API<br/>🌤️ Real-time Weather<br/>🌡️ Temperature & Humidity<br/>💨 Air Quality Index<br/>🔮 Forecasting Data]

        IOT[IoT Device Categories<br/>📺 Entertainment: TV, Speaker<br/>🌡️ Climate: AC, Fan, Thermostat<br/>💡 Lighting: Smart Bulbs, Switches<br/>🔒 Security: Camera, Lock, Doorbell<br/>🍳 Kitchen: Fridge, Microwave<br/>🧹 Cleaning: Robot Vacuum]

        UI[User Interface<br/>💻 Command Line Terminal<br/>⌨️ Keyboard Input<br/>🖥️ Cross-platform Display<br/>📱 Future: Mobile/Web]
    end

    %% Security Layer (Overlay)
    subgraph SEC["🔐 SECURITY ARCHITECTURE"]
        AUTH[Authentication Layer<br/>🔐 BCrypt Hashing Cost: 12<br/>📧 Email-based Identity<br/>🎫 Session Tokens<br/>🚫 Failed Login Protection]

        AUTHZ[Authorization Layer<br/>👑 Role-based Access Control<br/>🏠 Device-level Permissions<br/>👥 Group-based Sharing<br/>✅ Action-level Security]

        DATA_PROT[Data Protection Layer<br/>🔒 Local Database Encryption<br/>🏠 No Cloud Transmission<br/>✅ Input Sanitization<br/>🛡️ SQL Injection Prevention]
    end

    %% Connections - Presentation to Service
    CLI --> SHS
    SCAN --> SHS
    NAV --> SHS

    %% Core Service Hub Connections
    SHS --> CS
    SHS --> GS
    SHS --> EMS
    SHS --> TS
    SHS --> SS
    SHS --> WS
    SHS --> CES
    SHS --> DHS
    SHS --> SM

    %% Inter-Service Connections
    CS -.-> SM
    GS --> EMS
    TS --> GS
    SS --> GS
    WS -.-> SS
    CES --> GS

    %% Service to Model Connections
    CS --> CUST
    GS --> GAD
    EMS --> DER
    CS --> DP
    GS --> DP

    %% Model to Data Connections
    CUST --> CT
    GAD --> GT
    DP --> PT
    DER --> ET
    CT --> DDB
    GT --> DDB
    PT --> DDB
    ET --> DDB

    %% External Connections
    WS -.-> WA
    GS -.-> IOT
    CLI -.-> UI

    %% Security Connections
    CS --> AUTH
    SM --> AUTH
    DP --> AUTHZ
    CS --> AUTHZ
    CUST --> DATA_PROT
    GAD --> DATA_PROT

    %% Apply Styles
    class CLI,SCAN,NAV presentation
    class SHS core
    class CS,GS,EMS,TS,SS,WS,CES,DHS,SM service
    class CUST,GAD,DP,DER model
    class DDB,CT,GT,PT,ET data
    class WA,IOT,UI external
    class AUTH,AUTHZ,DATA_PROT external